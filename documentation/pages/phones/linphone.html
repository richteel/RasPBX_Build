<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Linphone</title>
</head>
<body>

    <div id="pageHeader"></div>

    <div class="jumbotron text-center siteJumbotron">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <div class="siteFullNameBlock">
                        <span id="tagline" class="heading-6">The Electrical Engineering Log</span>
                    </div>
                    <h1>Linphone</h1>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <!-- START: Content -->



                <h2>Add extensions to RasPBX for the softphones</h2>
                <ol>
                    <li>
                        Open a web browser and navigate to http://raspbx.local/ or use the IP Address or your Raspberry Pi.<br />
                        <img src="../images/phones/linphone/RasPBX-Extensions_01.png"
                             alt="FreePBX Home Screen" />
                    </li>
                    <li>
                        Enter the username and password you created during the initial RasPBX setup and click the "Continue" button.<br />
                        <img src="../images/phones/linphone/RasPBX-Extensions_02.png"
                             alt="FreePBX Login Screen" />
                    </li>
                    <li>
                        Click on the "Applications" button and select the "Extensions" option from the drop-down menu.<br />
                        <img src="../images/phones/linphone/RasPBX-Extensions_03.png"
                             alt="FreePBX Dashboard" />
                        <img src="../images/phones/linphone/RasPBX-Extensions_04.png"
                             alt="FreePBX Dashboard-Applications &gt; Extensions menu" />
                    </li>
                    <li>
                        Click the "+Add Extension" button and select "Add New SIP [chan_pjsip] Extension" from the drop-down menu.<br />
                        <strong>NOTE:</strong> Other extension types may work but PJSIP is what I used here.<br />
                        <img src="../images/phones/linphone/RasPBX-Extensions_05.png"
                             alt="FreePBX Extensions Application - All Extensions tab" />
                        <img src="../images/phones/linphone/RasPBX-Extensions_06.png"
                             alt="FreePBX Extensions Application - Add New SIP [chang_pjsip] Extension" />
                    </li>
                    <li>
                        Enter values in the following fields and click the "Submit" button.<br />
                        <ul>
                            <li>User Extension</li>
                            <li>Display Name</li>
                            <li>Outbound CID</li>
                        </ul>
                        <strong>NOTES:</strong>
                        <ul>
                            <li>To get more information on a field, place your mouse over the "?" icons next to each field to view a description of what to enter in the field.</li>
                            <li>Click into the "Secret" field and copy the value as we will need it to setup the softphone.</li>
                        </ul>
                        <img src="../images/phones/linphone/RasPBX-Extensions_07.png"
                             alt="FreePBX Extensions Application - Add PJSIP Extension Screen" />
                    </li>
                    <li>
                        Click on the "Voicemail" tab to turn on voicemail for the extension.<br />
                        <img src="../images/phones/linphone/RasPBX-Extensions_12.png"
                             alt="FreePBX Extensions Application - Add PJSIP Extension Screen" />
                    </li>
                    <li>
                        Click on the "Yes" button for the "Enabled" option to enable voicemail. Enter a Voicemail Password. The
                        default is to enter the extension number. The user will need to change the password when setting up
                        voicemail if the password is the same as the extension. Once voicemail is enabled and the "Voicemail
                        Password" are set, click the "Submit" button.<br />
                        <img src="../images/phones/linphone/RasPBX-Extensions_13.png"
                             alt="FreePBX Extensions Application - Voicemail Password" />
                        <img src="../images/phones/linphone/RasPBX-Extensions_14.png"
                             alt="FreePBX Extensions Application - Submit Voicemail Settings" />
                    </li>
                    <li>
                        Repeat the above steps to add an extension for another softphone then click the "Apply Config" button.<br />
                        <img src="../images/phones/linphone/RasPBX-Extensions_08.png"
                             alt="FreePBX Extensions Application Screen - Add new extension" />
                        <img src="../images/phones/linphone/RasPBX-Extensions_09.png"
                             alt="FreePBX Extensions Application Screen - Extensions added" />
                    </li>
                    <li>
                        Click the "Settings" menu and select the "Asterisk SIP Settings" drop-down item.<br />
                        <img src="../images/phones/linphone/RasPBX-Extensions_15.png"
                             alt="FreePBX Extensions Application Screen" />
                    </li>
                    <li>
                        Click the "Detect Network Settings" button to get your current external IP Network Address, then click the "Submit" button.<br />
                        <img src="../images/phones/linphone/RasPBX-Extensions_16.png"
                             alt="FreePBX SIP Settings Screen - Detect Network Settings" />
                        <img src="../images/phones/linphone/RasPBX-Extensions_17.png"
                             alt="FreePBX SIP Settings Screen - Submit Changes" />
                    </li>
                    <li>
                        Apply the configuration changes by clicking on the red "Apply Config" button in the upper right corner.<br />
                        <img src="../images/phones/linphone/RasPBX-Extensions_09b.png"
                             alt="FreePBX SIP Settings Screen" />
                        <img src="../images/phones/linphone/RasPBX-Extensions_10.png"
                             alt="FreePBX SIP Settings Screen - Applying Changes" />
                        <img src="../images/phones/linphone/RasPBX-Extensions_11.png"
                             alt="FreePBX SIP Settings Screen - Changes Applied" />
                    </li>
                    <li>
                        Reboot the Raspberry Pi to have the SIP changes take effect. At the terminal window, log in, if
                        not already logged in and type the command "sudo shutdown -r now"<br />
                        <img src="../images/phones/linphone/RasPBX-Extensions_18.png"
                             alt="FreePBX SIP Settings Screen" />
                    </li>
                </ol>

                <h2>Install &amp; provision softphones</h2>
                <p>
                    This example will show installing <a href="https://www.linphone.org/" target="_blank" rel="noopener noreferrer">Linphone</a>
                    softphones on Windows and Android. It is possible to install the softphones on Linux and iOS as well. There
                    are other softphone software available such as <a href="http://www.zoiper.com/" target="_blank" rel="noopener noreferrer">Zoiper</a>.
                    It is not necessary to use the same operating systems or software.
                </p>
                <h3>Linphone on Windows</h3>
                <ol>
                    <li>
                        Go to the <a href="https://www.linphone.org/" target="_blank" rel="noopener noreferrer">Linphone Website</a>.
                        Go to the bottom of the page and click on the "Linphone for desktop" under the "Download" heading.
                        <br />
                        <img src="../images/phones/linphone/Softphone_Windows_01.png"
                             alt="Linphone website home page" />
                    </li>
                    <li>
                        Scroll down the page to the "Download Desktop versions" section and click the "Download Linphone for Windows"
                        button.<br />
                        <img src="../images/phones/linphone/Softphone_Windows_02.png"
                             alt="Linphone downloads page" />
                    </li>
                    <li>
                        Once Linphone has downloaded, run the install package to install Linphone.<br />
                        <img src="../images/phones/linphone/Softphone_Windows_03.png"
                             alt="Windows User Account Control (UAC) Window" />
                        <img src="../images/phones/linphone/Softphone_Windows_04.png"
                             alt="Linphone Setup Wizard" />
                        <img src="../images/phones/linphone/Softphone_Windows_05.png"
                             alt="Linphone License Agreement" />
                        <img src="../images/phones/linphone/Softphone_Windows_06.png"
                             alt="Linphone Install Location" />
                        <img src="../images/phones/linphone/Softphone_Windows_07.png"
                             alt="Linphone Start Menu Folder" />
                        <img src="../images/phones/linphone/Softphone_Windows_08.png"
                             alt="Linphone Installation Progress" />
                        <img src="../images/phones/linphone/Softphone_Windows_09.png"
                             alt="Linphone installation complete" />
                        <img src="../images/phones/linphone/Softphone_Windows_10.png"
                             alt="Windows Security Alert - Firewall" />
                    </li>
                    <li>
                        Start Linphone and click the "Use a SIP Account" button<br />
                        <img src="../images/phones/linphone/Softphone_Windows_11.png"
                             alt="Linphone application start screen" />
                    </li>
                    <li>
                        Enter the following information and click the "Use" button<br />
                        <ul>
                            <li>Username: This will be the extension that was setup in FreePBX</li>
                            <li>SIP Domain: Enter the IP Address of the RasPBX</li>
                            <li>Password: Enter the "Secret" value from when the extension was setup</li>
                            <li>Transport: Select "UDP"</li>
                        </ul>
                        <img src="../images/phones/linphone/Softphone_Windows_12.png"
                             alt="Linphone SIP Account screen" /><br />
                        After clicking the "Use" button, you will see the home screen with a green
                        status in the upper left corner, indicating that you are connected to the FreePBX server.
                        <br />
                        <img src="../images/phones/linphone/Softphone_Windows_13.png"
                             alt="FreePBX Extensions Application Screen" />
                    </li>
                    <li>
                        You may dial *43 to perform an echo test. If you do not hear yourself when you talk, reboot
                        the Raspberry Pi and try again. When changing SIP settings it is sometimes necessary to reboot
                        the FreePBX server.<br />
                        <img src="../images/phones/linphone/Softphone_Windows_14.png"
                             alt="FreePBX Extensions Application Screen" />

                    </li>
                </ol>
                <h3>Linphone on Android</h3>
                <ol>
                    <li>
                        Open the Android "Play Store" application and search for "Linphone". Select "Linphone from
                        the results and click the "Install" button.<br />
                        <img src="../images/phones/linphone/Softphone_Android_01.png"
                             alt="Android Play Store" />
                        <img src="../images/phones/linphone/Softphone_Android_02.png"
                             alt="Android Play Store Search" />
                        <img src="../images/phones/linphone/Softphone_Android_03.png"
                             alt="Android Play Store Linphone application" />
                    </li>
                    <li>
                        Once the Linphone application installs, click the "Open" button to open the application.<br />
                        <img src="../images/phones/linphone/Softphone_Android_04.png"
                             alt="Android Play Store Linphone application - Installed" />
                    </li>
                    <li>
                        Click the "Use SIP Account" button on the "Welcome" screen of the Linphone application.<br />
                        <img src="../images/phones/linphone/Softphone_Android_05.png"
                             alt="Linphone application Welcome screen" />
                    </li>
                    <li>
                        Enter the following information in the SIP account screen and click the "Login" button.<br />
                        <ul>
                            <li>Username: This will be the extension that was setup in FreePBX</li>
                            <li>Password: Enter the "Secret" value from when the extension was setup</li>
                            <li>Domain: Enter the IP Address of the RasPBX</li>
                            <li>Transport: Select "UDP"</li>
                        </ul>
                        <img src="../images/phones/linphone/Softphone_Android_06.png"
                             alt="Linphone SIP account setup - blank" />
                        <img src="../images/phones/linphone/Softphone_Android_07.png"
                             alt="Linphone SIP account setup - filled in" />
                    </li>
                    <li>
                        Follow the prompts to provide Linphone with the permissions needed to run properly.<br />
                        <img src="../images/phones/linphone/Softphone_Android_21.png"
                             alt="Linphone requesting access to contacts permission" />
                        <img src="../images/phones/linphone/Softphone_Android_08.png"
                             alt="Prompt to grant access to 'Do Not Disturb' settings" />
                        <img src="../images/phones/linphone/Softphone_Android_09.png"
                             alt="Android Do Not Disturb Permission Screen" />
                        <img src="../images/phones/linphone/Softphone_Android_10.png"
                             alt="Android Do Not Disturb Permission Screen - Linphone setting" />
                        <img src="../images/phones/linphone/Softphone_Android_11.png"
                             alt="Android Do Not Disturb Permission Screen - System Prompt" />
                    </li>
                    <li>
                        Return to the Linphone application and note that the upper left corner show a green "Connected"
                        status, indicating that it is connected to the FreePBX server.<br />
                        <img src="../images/phones/linphone/Softphone_Android_12.png"
                             alt="Linphone application screen" />
                    </li>
                    <li>
                        Now we must fix an issue with Linphone. Linphone adds the country code prefix to every call so we
                        need to configure it not to add the country code. Click the menu in the upper left corner to pop
                        out the menu items.<br />
                        <img src="../images/phones/linphone/Softphone_Android_13.png"
                             alt="Linphone application screen" />
                    </li>
                    <li>
                        Click on the account at the top of the menu.<br />
                        <img src="../images/phones/linphone/Softphone_Android_14.png"
                             alt="Linphone application menu items" />
                    </li>
                    <li>
                        Locate "Prefix" in the options, remove the value, then click the arrow in the upper
                        left corner to return to the main screen.<br />
                        <img src="../images/phones/linphone/Softphone_Android_15.png"
                             alt="Linphone account settings - Prefix default setting" />
                        <img src="../images/phones/linphone/Softphone_Android_16.png"
                             alt="Linphone account settings - Prefix cleared" /><br />
                        <strong>NOTE:</strong> If you do not remove the "Prefix" value you will see an error notification
                        when attempting to call other extensions stating, "User not found".<br />
                        <img src="../images/phones/linphone/Softphone_Android_17.png"
                             alt="Linphone 'User not found' error" />
                    </li>
                    <li>
                        You may dial *43 to perform an echo test. If you do not hear yourself when you talk,
                        reboot the Raspberry Pi and try again. When changing SIP settings it is sometimes
                        necessary to reboot the FreePBX server.<br />
                        <img src="../images/phones/linphone/Softphone_Android_18.png"
                             alt="Linphone application screen" /><br />
                        When placing your first call, Linphone will ask for additional permissions. When prompted, select "Allow" permissions.<br />
                        <img src="../images/phones/linphone/Softphone_Android_19.png"
                             alt="Linphone requesting make and manage phone calls permission" />
                        <img src="../images/phones/linphone/Softphone_Android_20.png"
                             alt="Linphone requesting record audio permission" />
                    </li>

                </ol>
                <h3>Place a test call</h3>
                <ol>
                    <li>
                        From the Windows Linphone application, place a call to the Android application by typing the
                        extension and clicking the phone icon that appears below the text box.<br />
                        <img src="../images/phones/linphone/Softphone_TestCall_01.png"
                             alt="Linphone Windows Application Screen" /><br />
                        Answer the call on the Android device.<br />
                        <img src="../images/phones/linphone/Softphone_TestCall_02.png"
                             alt="Linphone Android Application Screen" />
                    </li>
                    <li>
                        From the Android Linphone application, place a call to the Windows application.<br />
                        <img src="../images/phones/linphone/Softphone_TestCall_03.png"
                             alt="Linphone Android Application Screen" /><br />
                        Answer the call on the Windows device.<br />
                        <img src="../images/phones/linphone/Softphone_TestCall_04.png"
                             alt="Linphone Windows Application Screen" />
                    </li>
                </ol>

                <h2>Troubleshooting</h2>
                <p>
                    <strong>No Audio on Windows PC:</strong> If you do not hear audio on the PC, then it may be due to a bug in Linphone. A solution is posted at
                    <a href="https://github.com/BelledonneCommunications/linphone-desktop/issues/295">https://github.com/BelledonneCommunications/linphone-desktop/issues/295</a>.
                    The solution is to right-click on the speaker in the Windows taskbar and enabling Spatial Sound. This issue has persisted since at least version 4.1.1 on
                    Windows and continues with the current version, Desktop 4.3.2 - Qt5.14.2 Core 5.0.49.<br />
                    <img src="../images/phones/linphone/LinPhoneAudioFix.png" alt="Windows Sound widget context-menu in the taskbar with Spatial Sound highlighted" />
                </p>

                <!-- END: Content -->
            </div>
        </div>
    </div>

    <div id="pageFooter"></div>

    <script>
        if (window.top.location.href.startsWith("https://github.com")) {
            document.write('<script src="https://github.com/richteel/RasPBX_Build/tree/main/documentation/pages/js/load.js"><\/script>');
        }
        else {
            let url = window.top.location.href.substring(0, window.top.location.href.search("/pages/")) + "/pages/js/load.js";

            document.write('<script src="' + url + '"><\/script>');
        }
    </script>

</body>
</html>